<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pardhu ERP – Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#f4f6f8;
}
.header{
  background:#25D366;
  color:#fff;
  padding:15px;
  text-align:center;
  font-size:20px;
}
.role{
  font-size:14px;
  opacity:0.9;
}
.container{
  padding:15px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:15px;
  margin-bottom:20px;
}
.card{
  background:#fff;
  padding:20px;
  border-radius:12px;
  text-align:center;
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
  cursor:pointer;
}
.card h3{
  margin:0;
  font-size:16px;
}
.section-title{
  margin:15px 0 10px;
  font-size:18px;
}
.product{
  background:#fff;
  padding:10px;
  margin-bottom:8px;
  border-radius:8px;
  box-shadow:0 2px 6px rgba(0,0,0,0.08);
  font-size:14px;
}
.logout{
  margin-top:20px;
  background:#e53935;
  color:#fff;
  padding:14px;
  text-align:center;
  border-radius:8px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="header">
  Pardhu ERP
  <div class="role" id="roleText"></div>
</div>

<div class="container">

  <!-- DASHBOARD CARDS -->
  <div class="grid">
    <div class="card" data-module="products" onclick="window.location.href='products.html'">
      <h3>Products</h3>
    </div>

    <div class="card" data-module="stock" onclick="alert('Stock – next step')">
      <h3>Stock</h3>
    </div>

    <div class="card" data-module="orders" onclick="window.location.href='orders.html'">
      <h3>Orders</h3>
    </div>

    <div class="card" data-module="reports" onclick="alert('Reports – next step')">
      <h3>Reports</h3>
    </div>

    <div class="card" data-module="settings" onclick="alert('Settings – admin only')">
      <h3>Settings</h3>
    </div>
    
    <div class="card" data-module="settings"
     onclick="window.location.href='employees.html'">
  <h3>Employees</h3>
    </div>
  </div>

  <!-- LIVE PRODUCTS -->
  <div class="section-title">Products (Live)</div>
  <div id="productList">Loading...</div>

  <div class="logout" onclick="logout()">Logout</div>
</div>

<script>
/* =========================
   RBAC CHECK
========================= */
const role = localStorage.getItem("role");
const modules = (localStorage.getItem("modules") || "").toLowerCase();

if(!role){
  window.location.href = "index.html";
}

document.getElementById("roleText").innerText =
  role === "super" ? "Super Admin" :
  role === "admin" ? "Company Admin" : "Staff";

if(modules !== "all"){
  const allowed = modules.split(",").map(m => m.trim());
  document.querySelectorAll(".card").forEach(card => {
    if(!allowed.includes(card.dataset.module)){
      card.style.display = "none";
    }
  });
}

function logout(){
  localStorage.clear();
  window.location.href = "index.html";
}

/* =========================
   GOOGLE SHEET – PRODUCTS
========================= */
const SHEET_ID = "1ZG49Svf_a7sjtxv87Zx_tnk8_ymVurhcCm0YzrgKByo";
const SHEET_NAME = "Products"; // MUST match tab name exactly

const API_URL =
  `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}&t=${Date.now()}`;

/* =========================
   FETCH & DISPLAY PRODUCTS
========================= */
fetch(API_URL)
  .then(res => res.text())
  .then(text => {
    const json = JSON.parse(
      text.substring(text.indexOf('{'), text.lastIndexOf('}') + 1)
    );

    const rows = json.table.rows;
    let html = "";

    rows.forEach(r => {
      if(!r.c) return;

      // Columns:
      // A id | B name | C price | D stock | E category | F image | G active
      const active = r.c[6]?.v;
      if(!active || active.toString().toLowerCase() !== "yes") return;

      const name = r.c[1]?.v || "Item";
      const price = r.c[2]?.v || 0;
      const stock = r.c[3]?.v || 0;
      const category = r.c[4]?.v || "-";

      html += `
        <div class="product">
          <b>${name}</b><br>
          Price: ₹${price}<br>
          Stock: ${stock}<br>
          Category: ${category}
        </div>
      `;
    });

    document.getElementById("productList").innerHTML =
      html || "No active products";

  })
  .catch(e => {
    console.error(e);
    document.getElementById("productList").innerText = "Error loading data";
  });
  
  <script>
/* ===== DASHBOARD RBAC ===== */

const modulesRaw = localStorage.getItem("modules") || "";
const role = localStorage.getItem("role");

if(!role){
  window.location.href = "index.html";
}

const allowed =
  modulesRaw === "all"
  ? ["all"]
  : modulesRaw.split(",").map(m => m.trim());

document.querySelectorAll(".card").forEach(card => {
  const mod = card.getAttribute("data-module");

  if(allowed.includes("all")) return;

  if(!allowed.includes(mod)){
    card.style.display = "none";
  }
});
</script>

</body>
</html>
