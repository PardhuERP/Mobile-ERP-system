<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Create Order</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#f4f6f8}
.header{background:#25d366;color:#fff;padding:15px;text-align:center}
.container{padding:15px}
input,select,button{width:100%;padding:12px;margin-bottom:10px}
button{background:#25d366;color:#fff;border:none}
button:disabled{background:#999}
</style>
</head>

<body>

<script>
const role = localStorage.getItem("role");
const modules = (localStorage.getItem("modules")||"").toLowerCase();
if(!role) location.replace("index.html");
if(modules!=="all" && !modules.split(",").includes("orders")){
  alert("Access denied");
  location.replace("dashboard.html");
}
</script>

<div class="header">Create Order</div>

<div class="container">
  <input id="customer" placeholder="Customer">
  <input id="product" placeholder="Product">
  <input id="product_id" placeholder="Product ID">
  <input id="qty" type="number" placeholder="Qty">
  <input id="total" type="number" placeholder="Total">
  <input id="paid" type="number" placeholder="Paid">

  <select id="payment_mode">
    <option value="cash">Cash</option>
    <option value="upi">UPI</option>
  </select>

  <button id="btn" onclick="createOrder()">Create Order</button>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzrwM8NxpGcgTpX0UUoElfs94U-CGHnFiL7S2zWtkWwGq2p2GqAbRlPOWfnpEo7hBbHFw/exec";
let submitting = false;

function createOrder(){
  if(submitting) return;
  submitting = true;

  const btn = document.getElementById("submitBtn");
  btn.disabled = true;
  btn.innerText = "Saving...";

  const qtyVal = Number(qty.value || 0);
  const totalVal = Number(total.value || 0);
  const paidVal = Number(paid.value || 0);

  const formData = new URLSearchParams();
  formData.append("customer", customer.value.trim());
  formData.append("product", product.value.trim());
  formData.append("product_id", product_id.value.trim());
  formData.append("qty", qtyVal);
  formData.append("total", totalVal);
  formData.append("paid", paidVal);
  formData.append("balance", totalVal - paidVal);
  formData.append("company", localStorage.getItem("company"));
  formData.append("payment_mode", payment_mode.value);
  formData.append("created_by", localStorage.getItem("user"));

  fetch(API_URL, {
    method: "POST",
    body: formData
  })
  .then(r => r.json())
  .then(res => {
    if(res.success){
      alert("✅ Order created: " + res.order_id);
      location.href = "orders.html";
    } else {
      alert("❌ " + res.error);
    }
  })
  .catch(err => {
    console.error(err);
    alert("❌ Network / API error");
  })
  .finally(()=>{
    submitting = false;
    btn.disabled = false;
    btn.innerText = "Create Order";
  });
}
</script>

</body>
</html>
