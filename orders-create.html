<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Create Order</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#f4f6f8}
.header{background:#25d366;color:#fff;padding:15px;text-align:center}
.container{padding:15px}
input,select,button{width:100%;padding:12px;margin-bottom:10px}
button{background:#25d366;color:#fff;border:none}
button:disabled{background:#999}
</style>
</head>

<body>

<script>
const role = localStorage.getItem("role");
const modules = (localStorage.getItem("modules")||"").toLowerCase();
if(!role) location.replace("index.html");
if(modules!=="all" && !modules.split(",").includes("orders")){
  alert("Access denied");
  location.replace("dashboard.html");
}
</script>

<div class="header">Create Order</div>

<div class="container">
  <input id="customer" placeholder="Customer">
  <input id="product" placeholder="Product">
  <input id="product_id" placeholder="Product ID">
  <input id="qty" type="number" placeholder="Qty">
  <input id="total" type="number" placeholder="Total">
  <input id="paid" type="number" placeholder="Paid">

  <select id="payment_mode">
    <option value="cash">Cash</option>
    <option value="upi">UPI</option>
  </select>

  <button id="btn" onclick="createOrder()">Create Order</button>
</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbzrwM8NxpGcgTpX0UUoElfs94U-CGHnFiL7S2zWtkWwGq2p2GqAbRlPOWfnpEo7hBbHFw/exec";
let lock=false;

function createOrder(){
  if(lock) return;
  lock=true;

  const btn=document.getElementById("btn");
  btn.disabled=true;
  btn.innerText="Saving...";

  const data=new URLSearchParams();
  data.append("customer",customer.value);
  data.append("product",product.value);
  data.append("product_id",product_id.value);
  data.append("qty",qty.value);
  data.append("total",total.value);
  data.append("paid",paid.value);
  data.append("balance",total.value-paid.value);
  data.append("company",localStorage.getItem("company"));
  data.append("created_by",localStorage.getItem("user"));

  fetch(API_URL,{method:"POST",body:data})
  .then(r=>r.json())
  .then(res=>{
    if(res.success){
      alert("Order created: "+res.order_id);
      location.replace("orders.html");
    }else{
      alert(res.error);
    }
  })
  .catch(()=>alert("Network error"))
  .finally(()=>{
    lock=false;
    btn.disabled=false;
    btn.innerText="Create Order";
  });
}
</script>

</body>
</html>
